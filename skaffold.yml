apiVersion: skaffold/v4beta13
kind: Config

manifests:
  rawYaml:
    - infra/k8s-storage
    - infra/k8s-dev/*
#      - infra/k8s-monitor/*
deploy:
  kubectl: {}

build:
  local:
    push: false
    useBuildkit: true
  platforms: ["linux/amd64"]

#  artifacts:
#    - image: willnguyen/glassdoor-server
#      context: server
#      platforms: ["linux/amd64"]
#      docker:
#        dockerfile: Dockerfile
#
#      sync:
#        manual:
#          - src: "app/**/*.rb"
#            dest: "app"
#          - src: "app/**/*.erb"
#            dest: "app"
#          - src: "lib/**/*.erb"
#            dest: "app"
#          - src: "config/**/*.rb"
#            dest: "config"
#          - src: "Gemfile"
#            dest: "."
#          - src: "Gemfile.lock"
#            dest: "."
#  hooks:
#    after:
#      - command:
#        - kubectl
#        - exec
#        - deployment/server
#        - --
#        - bundle
#        - exec
#        - rails
#        - db:create
#      - command:
#        - kubectl
#        - exec
#        - deployment/server
#        - --
#        - bundle
#        - exec
#        - rails
#        - db:migrate

portForward:
  - resourceType: service
    resourceName: postgres
    port: 5432
    localPort: 5432
  - resourceType: service
    resourceName: elasticsearch
    port: 9200
    localPort: 9200